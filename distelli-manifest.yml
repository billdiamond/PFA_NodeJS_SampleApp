seteam/PFA_NodeJS_SampleApp:
  # This Basic Distelli Manifest assumes the following
  # has been provisioned on the destination deploy server:

  PkgInclude:
    - 'Boltdir/'
    - 'server.js'
  PreInstall:
    - echo "PreInstall Starting."
    - if sudo yum repolist | grep puppet; then echo skipping puppet repo install; else sudo rpm -Uvh https://yum.puppet.com/puppet/puppet-release-el-7.noarch.rpm; fi
    - sudo yum install -y puppet-bolt
    - sudo /usr/local/bin/bolt plan run sampleapp::prereqs
    - sudo setcap cap_net_bind_service=+ep `readlink -f \`which node\``
  Exec:
    - echo "Exec Starting."
    - publicip=$(curl -s ident.me) || true
    - 'echo "****************************************************************"'
    - 'echo     "NodeJS application will start on: http://$publicip"'
    - 'echo "****************************************************************"'
    - exec node server.js
  PostStart:
    - publicip=$(curl -s ident.me) || true
    - curl -s "http://$publicip" | grep 'Your Node.js application is working!'
